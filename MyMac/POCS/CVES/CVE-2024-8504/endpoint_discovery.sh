#!/bin/bash

# Check for domain argument
domain=$1
if [ -z "$domain" ]; then
    echo "Usage: ./endpoint_discovery.sh <domain>"
    exit 1
fi

# Check for required tools
for tool in waybackurls gau qsreplace; do
    if ! command -v $tool &> /dev/null; then
        echo "Error: $tool is not installed or not in your PATH."
        exit 1
    fi
done

# Set up directories and check for subdomain file
input_file="all_subdomains.txt"
output_dir="recon/$domain"

if [ ! -f "$input_file" ]; then
    echo "Error: $input_file not found. Ensure this file exists."
    exit 1
fi

mkdir -p "$output_dir" || exit 1

# Generate URLs using waybackurls and gau
echo "[*] Gathering URLs..."
cat "$input_file" | waybackurls > "$output_dir/waybackurls.txt"
cat "$input_file" | gau >> "$output_dir/waybackurls.txt"
sort -u "$output_dir/waybackurls.txt" -o "$output_dir/waybackurls.txt"

# Extract parameters
echo "[*] Extracting parameters..."
cat "$output_dir/waybackurls.txt" | grep "=" | qsreplace -a > "$output_dir/params.txt"

echo "[*] Endpoints and parameters saved to $output_dir."
